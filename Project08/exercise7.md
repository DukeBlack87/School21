# Docker и Kubernetes

## Docker

**Docker** — это платформа для разработки, доставки и запуска контейнерных приложений. Docker позволяет создавать контейнеры, автоматизировать их запуск и развертывание, управляет жизненным циклом. Он позволяет запускать множество контейнеров на одной хост-машине.

**Контейнеры** — это способ стандартизации развертки приложения и отделения его от общей инфраструктуры. Экземпляр приложения запускается в изолированной среде, не влияющей на основную операционную систему.

Разработчикам не нужно задумываться, в каком окружении будет работать их приложение, будут ли там нужные настройки и зависимости. Они просто создают приложение, упаковывают все зависимости и настройки в некоторый единый образ. Затем этот образ можно запускать на других системах, не беспокоясь, что приложение не запустится.

Преимущества использования контейнеров Docker
Контейнеры упрощают работу как программистам, так и администраторам, которые развертывают эти приложения.

**Docker** решает проблемы зависимостей и рабочего окружения
Контейнеры позволяют упаковать в единый образ приложение и все его зависимости: библиотеки, системные утилиты и файлы настройки. Это упрощает перенос приложения на другую инфраструктуру.

Например, разработчики создают приложение в системе разработки — там все настроено, приложение работает. Когда оно готово, его нужно перенести в систему тестирования, а затем в продуктивную среду. Если в одной из них нет нужной зависимости, приложение не будет работать. Программистам придется отвлечься от разработки и совместно с командой поддержки разобраться в ситуации.

В контейнерах такой проблемы нет, так как они содержат в себе все необходимое для запуска приложения. Специалисты занимаются разработкой, а не решением инфраструктурных проблем.

**Изоляция и безопасность**

Контейнер — это набор процессов, изолированных от основной операционной системы. Приложения работают только внутри контейнеров и не имеют доступа к основной операционной системе. Это повышает безопасность приложений, они не смогут случайно или умышленно навредить основной системе. Если приложение в контейнере завершится с ошибкой или зависнет, это никак не затронет основную ОС.

**Ускорение и автоматизация развертывания приложений и масштабируемость**

Контейнеры упрощают развертывание приложений. В классическом подходе для установки программы нужно совершить несколько действий: выполнить скрипт, изменить файлы настроек и так далее. В этом процессе не исключена вероятность человеческой ошибки: пользователь запустит скрипт два раза, перепутает последовательность или что-то не поймет. Контейнеры позволяют полностью автоматизировать этот процесс, так как включают в себя все нужные зависимости и порядок выполнения действий.

Также контейнеры упрощают развертывание на нескольких серверах. В классическом подходе для того, чтобы развернуть одно и то же приложение на нескольких машинах, нужно будет повторять одни и те же действия. Контейнеры избавляют от этой рутинной работы и позволяют автоматизировать развертывание.

**Контейнеры приближают к микросервисной архитектуре**

Контейнеры хорошо вписываются в микросервисную архитектуру. Это подход к разработке, при котором приложение разбивается на небольшие компоненты, по возможности независимые. Обычно противопоставляется монолитной архитектуре, где все части системы сильно связаны друг с другом.

Это позволяет разрабатывать новую функциональность быстрее, ведь в случае с монолитной архитектурой изменение какой-то части может затронуть всю остальную систему.

## Отличия Docker от виртуальной машины

Docker, и виртуальные машины обладают собственным уникальным набором преимуществ, у Docker есть несколько преимуществ по сравнению с виртуальными машинами, которые делают его более привлекательным вариантом для многих разработчиков и организаций.

**Плюсы докера**

1. Одним из основных преимуществ Docker является его легкость. Поскольку контейнеры Docker содержат только необходимые компоненты для запуска определенного приложения, они значительно меньше по размеру и быстрее запускаются, чем виртуальные машины. Это делает Docker идеальным решением для ситуаций, когда важно быстрое развертывание и быстрый запуск, например, в облачных средах или для микросервисов.

2. Еще одним преимуществом Docker является его мобильность. Поскольку контейнеры Docker автономны и включают в себя все необходимые зависимости для запуска приложения, их можно легко перемещать из одной среды в другую без каких-либо проблем с совместимостью. Это позволяет разработчикам легко тестировать и развертывать приложения на различных платформах и средах, таких как локальные среды разработки, промежуточные серверы и производственные среды.

3. Помимо легкости и портативности, Docker также обладает мощными возможностями управления ресурсами. Docker позволяет разработчикам выделять определенные ресурсы, такие как ЦП и память, для контейнеров, гарантируя, что у каждого приложения есть ресурсы, необходимые для бесперебойной работы. Это помогает оптимизировать использование ресурсов и предотвратить такие проблемы, как конкуренция за ресурсы, которая может возникнуть в виртуальных машинах, когда несколько операционных систем работают на одном физическом хосте.

4. Наконец, Docker имеет большое и активное сообщество разработчиков и пользователей, а это означает, что для тех, кто хочет использовать платформу, доступно множество документации, учебных пособий и поддержки. Это может облегчить разработчикам начало работы с Docker и поиск решений любых проблем, с которыми они сталкиваются на этом пути.

**Вывод**

Таким образом, Docker предлагает несколько преимуществ по сравнению с виртуальными машинами, включая легкость, переносимость, широкие возможности управления ресурсами и активное сообщество разработчиков и пользователей. Эти факторы делают Docker привлекательным вариантом для многих разработчиков и организаций, стремящихся к контейнеризации и развертыванию своих приложений гибким и эффективным способом.

Вот таблица, которая показывает различия между виртуальной машиной и контейнером Docker

| **Виртуальная машина** | **Docker контейнер** |
|:------------------ |:--------------- |
Изоляция процесса на аппаратном уровне |    Изоляция процесса на уровне ОС
Каждая виртуальная машина имеет отдельную ОС | Каждый контейнер может совместно использовать ОС
Загружается в считанные минуты | Загружается в считанные секунды
Виртуальные машины занимают несколько ГБ | Контейнеры легкие (КБ / МБ)
Готовые виртуальные машины трудно найти | Док-контейнеры легко доступны
Виртуальные машины могут легко перейти на новый хост | Контейнеры уничтожаются и воссоздаются, а не перемещаются
Создание ВМ занимает относительно больше времени | Контейнеры могут быть созданы в считанные секунды
Больше использования ресурса | Меньшее использование ресурсов

## Docker Compose

**Docker Compose** — это инструментальное средство, входящее в состав Docker. Оно предназначено для решения задач, связанных с развёртыванием проектов.

Изучая основы Docker можно столкнуться с созданием простейших приложений, работающих автономно, не зависящих, например, от внешних источников данных или от неких сервисов. На практике же подобные приложения — редкость. Реальные проекты обычно включают в себя целый набор совместно работающих приложений.

Как узнать, нужно ли, при развёртывании некоего проекта, воспользоваться Docker Compose? На самом деле — очень просто. Если для обеспечения функционирования этого проекта используется несколько сервисов, то Docker Compose может вам пригодиться. Например, в ситуации, когда создают веб-сайт, которому, для выполнения аутентификации пользователей, нужно подключиться к базе данных. Подобный проект может состоять из двух сервисов — того, что обеспечивает работу сайта, и того, который отвечает за поддержку базы данных.

**Технология Docker Compose**, если описывать её упрощённо, позволяет, с помощью одной команды, запускать множество сервисов.

**Разница между Docker и Docker Compose.**

**Docker применяется** для управления отдельными контейнерами (сервисами), из которых состоит приложение.

**Docker Compose используется** для одновременного управления несколькими контейнерами, входящими в состав приложения. Этот инструмент предлагает те же возможности, что и Docker, но позволяет работать с более сложными приложениями.

## Kubernetes

**Kubernetes** — это портативная расширяемая платформа с открытым исходным кодом для управления контейнеризованными рабочими нагрузками и сервисами, которая облегчает как декларативную настройку, так и автоматизацию. У платформы есть большая, быстро растущая экосистема.

**Зачем Kubernetes и что он может сделать?**

Контейнеры — отличный способ связать и запустить ваши приложения. В производственной среде необходимо управлять контейнерами, которые запускают приложения, и гарантировать отсутствие простоев. Например, если контейнер выходит из строя, необходимо запустить другой контейнер. Не было бы проще, если бы такое поведение обрабатывалось системой?

Вот тут Kubernetes приходит на помощь! Kubernetes дает фреймворк для гибкой работы распределенных систем. Он занимается масштабированием и обработкой ошибок в приложении, предоставляет шаблоны развертывания и многое другое. Например, Kubernetes может легко управлять канареечным развертыванием вашей системы.

**Kubernetes предоставляет:**

- Мониторинг сервисов и распределение нагрузки Kubernetes может обнаружить контейнер, используя имя DNS или собственный IP-адрес. Если трафик в контейнере высокий, Kubernetes может сбалансировать нагрузку и распределить сетевой трафик, чтобы развертывание было стабильным.

- Оркестрация хранилища Kubernetes позволяет вам автоматически смонтировать систему хранения по вашему выбору, такую как локальное хранилище, провайдеры общедоступного облака и многое другое.

- Автоматическое развертывание и откаты Используя Kubernetes можно описать желаемое состояние развернутых контейнеров и изменить фактическое состояние на желаемое. Например, вы можете автоматизировать Kubernetes на создание новых контейнеров для развертывания, удаления существующих контейнеров и распределения всех их ресурсов в новый контейнер.

- Автоматическое распределение нагрузки Вы предоставляете Kubernetes кластер узлов, который он может использовать для запуска контейнерных задач. Вы указываете Kubernetes, сколько ЦП и памяти (ОЗУ) требуется каждому контейнеру. Kubernetes может разместить контейнеры на ваших узлах так, чтобы наиболее эффективно использовать ресурсы.

- Самоконтроль Kubernetes перезапускает отказавшие контейнеры, заменяет и завершает работу контейнеров, которые не проходят определенную пользователем проверку работоспособности, и не показывает их клиентам, пока они не будут готовы к обслуживанию.

- Управление конфиденциальной информацией и конфигурацией Kubernetes может хранить и управлять конфиденциальной информацией, такой как пароли, OAuth-токены и ключи SSH. Вы можете развертывать и обновлять конфиденциальную информацию и конфигурацию приложения без изменений образов контейнеров и не раскрывая конфиденциальную информацию в конфигурации стека.

**Главное преимущество Kubernetes — автоматизация**
Основное преимущество Kubernetes перед простыми Docker-контейнерами можно описать одним словом — автоматизация. Но под этой автоматизацией понимается много различных возможностей, о которых мы расскажем далее и приведем несколько конкретных примеров.

Нужно отметить, что все эти автоматизации можно сделать и без Kubernetes, но для этого придется использовать много отдельных инструментов, настраивать их и писать скрипты. Например, для автоматизации выкатки обновлений приложений можно использовать Ansible — систему управления конфигурациями. Такая система может обновить все инстансы приложения и убедиться, что оно работает. Но для этого она должна знать, какие хосты сейчас работают, как к ним обратиться, на каких именно хостах работают инстансы нужного приложения. Для этого придется писать скрипты, которые будут за этим следить.

Заниматься поддержкой этих скриптов и инструментов придется самостоятельно. Иногда могут возникать проблемы, например, если у одного из инструментов выйдет новая версия, которая несовместима с другими инструментами. Или для новой версии инструмента придется переписывать скрипты, потому что поменяется логика работы этого инструмента.

В Kubernetes все эти автоматизации уже включены, они разрабатываются и поддерживаются большим сообществом разработчиков. Когда выходит новая версия Kubernetes, разработчики тестируют и проверяют все сами, а значит, все внутренние интеграции и автоматизации точно будут работать.

**Единое управление всеми узлами**

Когда в инфраструктуре становится много узлов (серверов, на которых работают контейнеры), ими нужно централизованно управлять. Удобней всего иметь центральную точку управления, которая может принять команды и выполнить действия вне зависимости от того, на каком узле находятся контейнеры.

Docker работает в рамках отдельных узлов. Если у вас несколько узлов, то на каждом из них запущен докер-демон, который ничего не знает о существовании других узлов. Каждый демон знает лишь о том, что происходит на его узле. И поэтому обычными докер-контейнерами сложно управлять централизованно.

У Kubernetes есть центральная точка управления — API-сервер. В кластере может быть много узлов, контейнеров и настроек, но всеми ими можно управлять через единый сервер. В кластер можно отправить команду (например, чтобы обновить наше приложение), и Kubernetes сам найдет, на каких узлах оно находится, и обновит его.